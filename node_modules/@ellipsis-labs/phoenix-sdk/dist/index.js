"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { newObj[key] = obj[key]; } } } newObj.default = obj; return newObj; } } function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }var wn=Object.defineProperty;var Hr=Object.getOwnPropertySymbols;var Sn=Object.prototype.hasOwnProperty,xn=Object.prototype.propertyIsEnumerable;var T=Math.pow,Jr=(r,e,t)=>e in r?wn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,k=(r,e)=>{for(var t in e||(e={}))Sn.call(e,t)&&Jr(r,t,e[t]);if(Hr)for(var t of Hr(e))xn.call(e,t)&&Jr(r,t,e[t]);return r};var f=(r,e,t)=>new Promise((i,n)=>{var s=u=>{try{a(t.next(u))}catch(c){n(c)}},o=u=>{try{a(t.throw(u))}catch(c){n(c)}},a=u=>u.done?i(u.value):Promise.resolve(u.value).then(s,o);a((t=t.apply(r,e)).next())});var _web3js = require('@solana/web3.js'); var Ai = _interopRequireWildcard(_web3js); var Ii = _interopRequireWildcard(_web3js); var Bi = _interopRequireWildcard(_web3js); var Wr = _interopRequireWildcard(_web3js); var Ue = _interopRequireWildcard(_web3js); var Er = _interopRequireWildcard(_web3js); var Ti = _interopRequireWildcard(_web3js); var Ki = _interopRequireWildcard(_web3js); var We = _interopRequireWildcard(_web3js); var Li = _interopRequireWildcard(_web3js); var Wi = _interopRequireWildcard(_web3js); var Ei = _interopRequireWildcard(_web3js); var xt = _interopRequireWildcard(_web3js); var Bt = _interopRequireWildcard(_web3js); var Kt = _interopRequireWildcard(_web3js); var Lt = _interopRequireWildcard(_web3js); var Et = _interopRequireWildcard(_web3js); var Rt = _interopRequireWildcard(_web3js); var zt = _interopRequireWildcard(_web3js); var Qt = _interopRequireWildcard(_web3js); var jt = _interopRequireWildcard(_web3js); var Ht = _interopRequireWildcard(_web3js); var Xt = _interopRequireWildcard(_web3js); var tr = _interopRequireWildcard(_web3js); var nr = _interopRequireWildcard(_web3js); var ar = _interopRequireWildcard(_web3js); var Ee = _interopRequireWildcard(_web3js); var dr = _interopRequireWildcard(_web3js); var gr = _interopRequireWildcard(_web3js); var kr = _interopRequireWildcard(_web3js);var w=new Map,S=new Map,ue= exports.InvalidMarketParametersError =class extends Error{constructor(){super("Invalid market parameters error");this.code=0;this.name="InvalidMarketParameters";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ue)}};w.set(0,()=>new ue);S.set("InvalidMarketParameters",()=>new ue);var ce=class extends Error{constructor(){super("Invalid exchange authority error");this.code=1;this.name="InvalidMarketAuthority";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ce)}};w.set(1,()=>new ce);S.set("InvalidMarketAuthority",()=>new ce);var le=class extends Error{constructor(){super("Market deserialization error");this.code=2;this.name="FailedToLoadMarketFromAccount";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,le)}};w.set(2,()=>new le);S.set("FailedToLoadMarketFromAccount",()=>new le);var be=class extends Error{constructor(){super("Market already initialized error");this.code=3;this.name="MarketAlreadyInitialized";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,be)}};w.set(3,()=>new be);S.set("MarketAlreadyInitialized",()=>new be);var de=class extends Error{constructor(){super("Market is not initialized error");this.code=4;this.name="MarketUninitialized";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,de)}};w.set(4,()=>new de);S.set("MarketUninitialized",()=>new de);var me=class extends Error{constructor(){super("Invalid state transition error");this.code=5;this.name="InvalidStateTransition";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,me)}};w.set(5,()=>new me);S.set("InvalidStateTransition",()=>new me);var pe=class extends Error{constructor(){super("Invalid market signer error");this.code=6;this.name="InvalidMarketSigner";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,pe)}};w.set(6,()=>new pe);S.set("InvalidMarketSigner",()=>new pe);var ge=class extends Error{constructor(){super("Invalid lot size error");this.code=7;this.name="InvalidLotSize";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ge)}};w.set(7,()=>new ge);S.set("InvalidLotSize",()=>new ge);var ye=class extends Error{constructor(){super("Invalid tick size error");this.code=8;this.name="InvalidTickSize";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ye)}};w.set(8,()=>new ye);S.set("InvalidTickSize",()=>new ye);var fe=class extends Error{constructor(){super("Invalid mint error");this.code=9;this.name="InvalidMint";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,fe)}};w.set(9,()=>new fe);S.set("InvalidMint",()=>new fe);var ke=class extends Error{constructor(){super("Invalid base vault error");this.code=10;this.name="InvalidBaseVault";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ke)}};w.set(10,()=>new ke);S.set("InvalidBaseVault",()=>new ke);var Pe=class extends Error{constructor(){super("Invalid quote vault error");this.code=11;this.name="InvalidQuoteVault";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Pe)}};w.set(11,()=>new Pe);S.set("InvalidQuoteVault",()=>new Pe);var he=class extends Error{constructor(){super("Invalid base account error");this.code=12;this.name="InvalidBaseAccount";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,he)}};w.set(12,()=>new he);S.set("InvalidBaseAccount",()=>new he);var we=class extends Error{constructor(){super("Invalid quote account error");this.code=13;this.name="InvalidQuoteAccount";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,we)}};w.set(13,()=>new we);S.set("InvalidQuoteAccount",()=>new we);var Se=class extends Error{constructor(){super("Too many events error");this.code=14;this.name="TooManyEvents";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Se)}};w.set(14,()=>new Se);S.set("TooManyEvents",()=>new Se);var xe=class extends Error{constructor(){super("New order error");this.code=15;this.name="NewOrderError";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,xe)}};w.set(15,()=>new xe);S.set("NewOrderError",()=>new xe);var Ae=class extends Error{constructor(){super("Reduce order error");this.code=16;this.name="ReduceOrderError";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ae)}};w.set(16,()=>new Ae);S.set("ReduceOrderError",()=>new Ae);var Ie=class extends Error{constructor(){super("Cancel multiple orders error");this.code=17;this.name="CancelMultipleOrdersError";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ie)}};w.set(17,()=>new Ie);S.set("CancelMultipleOrdersError",()=>new Ie);var Be=class extends Error{constructor(){super("Withdraw funds error");this.code=18;this.name="WithdrawFundsError";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Be)}};w.set(18,()=>new Be);S.set("WithdrawFundsError",()=>new Be);var Me=class extends Error{constructor(){super("Remove empty orders error");this.code=19;this.name="RemoveEmptyOrdersError";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Me)}};w.set(19,()=>new Me);S.set("RemoveEmptyOrdersError",()=>new Me);var Te=class extends Error{constructor(){super("Trader not found error");this.code=20;this.name="TraderNotFound";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Te)}};w.set(20,()=>new Te);S.set("TraderNotFound",()=>new Te);var Ke=class extends Error{constructor(){super("Invalid seat status");this.code=21;this.name="InvalidSeatStatus";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ke)}};w.set(21,()=>new Ke);S.set("InvalidSeatStatus",()=>new Ke);var Fe=class extends Error{constructor(){super("Failed to evict trader");this.code=22;this.name="EvictionError";typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Fe)}};w.set(22,()=>new Fe);S.set("EvictionError",()=>new Fe);function Ws(r){let e=w.get(r);return e!=null?e():null}function Es(r){let e=S.get(r);return e!=null?e():null}var _beet = require('@metaplex-foundation/beet'); var W = _interopRequireWildcard(_beet); var Ye = _interopRequireWildcard(_beet); var Re = _interopRequireWildcard(_beet); var Xr = _interopRequireWildcard(_beet); var E = _interopRequireWildcard(_beet); var v = _interopRequireWildcard(_beet); var qe = _interopRequireWildcard(_beet); var H = _interopRequireWildcard(_beet); var J = _interopRequireWildcard(_beet); var Oe = _interopRequireWildcard(_beet); var Q = _interopRequireWildcard(_beet); var z = _interopRequireWildcard(_beet); var L = _interopRequireWildcard(_beet); var Le = _interopRequireWildcard(_beet); var F = _interopRequireWildcard(_beet); var ve = _interopRequireWildcard(_beet); var ci = _interopRequireWildcard(_beet); var _ = _interopRequireWildcard(_beet); var di = _interopRequireWildcard(_beet); var l = _interopRequireWildcard(_beet); var gi = _interopRequireWildcard(_beet); var x = _interopRequireWildcard(_beet); var V = _interopRequireWildcard(_beet); var j = _interopRequireWildcard(_beet); var X = _interopRequireWildcard(_beet); var nt = _interopRequireWildcard(_beet); var $ = _interopRequireWildcard(_beet); var hi = _interopRequireWildcard(_beet); var ee = _interopRequireWildcard(_beet); var I = _interopRequireWildcard(_beet); var C = _interopRequireWildcard(_beet); var at = _interopRequireWildcard(_beet); var ut = _interopRequireWildcard(_beet); var ct = _interopRequireWildcard(_beet); var lt = _interopRequireWildcard(_beet); var bt = _interopRequireWildcard(_beet); var dt = _interopRequireWildcard(_beet); var mt = _interopRequireWildcard(_beet); var pt = _interopRequireWildcard(_beet); var gt = _interopRequireWildcard(_beet); var yt = _interopRequireWildcard(_beet); var ft = _interopRequireWildcard(_beet); var kt = _interopRequireWildcard(_beet); var G = _interopRequireWildcard(_beet); var St = _interopRequireWildcard(_beet); var It = _interopRequireWildcard(_beet); var Tt = _interopRequireWildcard(_beet); var Ot = _interopRequireWildcard(_beet); var Wt = _interopRequireWildcard(_beet); var Dt = _interopRequireWildcard(_beet); var vt = _interopRequireWildcard(_beet); var Nt = _interopRequireWildcard(_beet); var _t = _interopRequireWildcard(_beet); var Zt = _interopRequireWildcard(_beet); var Yt = _interopRequireWildcard(_beet); var er = _interopRequireWildcard(_beet); var ir = _interopRequireWildcard(_beet); var or = _interopRequireWildcard(_beet); var cr = _interopRequireWildcard(_beet); var br = _interopRequireWildcard(_beet); var pr = _interopRequireWildcard(_beet); var fr = _interopRequireWildcard(_beet); var hr = _interopRequireWildcard(_beet);var _beetsolana = require('@metaplex-foundation/beet-solana'); var Ar = _interopRequireWildcard(_beetsolana); var ei = _interopRequireWildcard(_beetsolana); var ri = _interopRequireWildcard(_beetsolana); var si = _interopRequireWildcard(_beetsolana); var ui = _interopRequireWildcard(_beetsolana); var tt = _interopRequireWildcard(_beetsolana); var Br = _interopRequireWildcard(_beetsolana); var Fr = _interopRequireWildcard(_beetsolana); var xi = _interopRequireWildcard(_beetsolana); var Qe = _interopRequireWildcard(_beetsolana); var Ui = _interopRequireWildcard(_beetsolana);var Yr=new W.BeetArgsStruct([["instruction",W.u8],["sequenceNumber",W.u64],["timestamp",W.i64],["slot",W.u64],["market",Ar.publicKey],["signer",Ar.publicKey],["totalEvents",W.u16]],"AuditLogHeader");var He=(t=>(t[t.Bid=0]="Bid",t[t.Ask=1]="Ask",t))(He||{}),Z= exports.sideBeet =Xr.fixedScalarEnum(He);var Je=new Re.BeetArgsStruct([["side",Z],["priceInTicks",Re.u64],["orderSequenceNumber",Re.u64]],"CancelOrderParams");var Xe=new Ye.FixableBeetArgsStruct([["orders",Ye.array(Je)]],"CancelMultipleOrdersByIdParams");var $e=new E.FixableBeetArgsStruct([["side",Z],["tickLimit",E.coption(E.u64)],["numOrdersToSearch",E.coption(E.u32)],["numOrdersToCancel",E.coption(E.u32)]],"CancelUpToParams");var Ir=new v.FixableBeetArgsStruct([["priceInTicks",v.u64],["sizeInBaseLots",v.u64],["lastValidSlot",v.coption(v.u64)],["lastValidUnixTimestampInSeconds",v.coption(v.u64)]],"CondensedOrder");var $r=new qe.BeetArgsStruct([["quoteLotsToDeposit",qe.u64],["baseLotsToDeposit",qe.u64]],"DepositParams");var ti=new H.BeetArgsStruct([["index",H.u16],["makerId",ei.publicKey],["orderSequenceNumber",H.u64],["priceInTicks",H.u64],["baseLotsEvicted",H.u64]],"EvictEvent");var ii=new J.BeetArgsStruct([["index",J.u16],["makerId",ri.publicKey],["orderSequenceNumber",J.u64],["priceInTicks",J.u64],["baseLotsRemoved",J.u64]],"ExpiredOrderEvent");var ni=new Oe.BeetArgsStruct([["index",Oe.u16],["feesCollectedInQuoteLots",Oe.u64]],"FeeEvent");var oi=new Q.BeetArgsStruct([["index",Q.u16],["makerId",si.publicKey],["orderSequenceNumber",Q.u64],["priceInTicks",Q.u64],["baseLotsFilled",Q.u64],["baseLotsRemaining",Q.u64]],"FillEvent");var ai=new z.BeetArgsStruct([["index",z.u16],["clientOrderId",z.u128],["totalBaseLotsFilled",z.u64],["totalQuoteLotsFilled",z.u64],["totalFeeInQuoteLots",z.u64]],"FillSummaryEvent");var et=new Le.BeetArgsStruct([["bidsSize",Le.u64],["asksSize",Le.u64],["numSeats",Le.u64]],"MarketSizeParams");var no=new L.FixableBeetArgsStruct([["marketSizeParams",et],["numQuoteLotsPerQuoteUnit",L.u64],["tickSizeInQuoteLotsPerBaseUnit",L.u64],["numBaseLotsPerBaseUnit",L.u64],["takerFeeBps",L.u16],["feeCollector",ui.publicKey],["rawBaseUnitsPerBaseUnit",L.coption(L.u32)]],"InitializeParams");var Mr=new ve.BeetArgsStruct([["decimals",ve.u32],["vaultBump",ve.u32],["mintKey",Br.publicKey],["vaultKey",Br.publicKey]],"TokenParams");var Tr=new F.BeetArgsStruct([["discriminant",F.u64],["status",F.u64],["marketSizeParams",et],["baseParams",Mr],["baseLotSize",F.u64],["quoteParams",Mr],["quoteLotSize",F.u64],["tickSizeInQuoteAtomsPerBaseUnit",F.u64],["authority",tt.publicKey],["feeRecipient",tt.publicKey],["marketSequenceNumber",F.u64],["successor",tt.publicKey],["rawBaseUnitsPerBaseUnit",F.u32],["padding1",F.u32],["padding2",F.uniformFixedSizeArray(F.u64,32)]],"MarketHeader");var li=(o=>(o[o.Uninitialized=0]="Uninitialized",o[o.Active=1]="Active",o[o.PostOnly=2]="PostOnly",o[o.Paused=3]="Paused",o[o.Closed=4]="Closed",o[o.Tombstoned=5]="Tombstoned",o))(li||{}),bi= exports.marketStatusBeet =ci.fixedScalarEnum(li);var mi=(n=>(n[n.FailOnInsufficientFundsAndAmendOnCross=0]="FailOnInsufficientFundsAndAmendOnCross",n[n.FailOnInsufficientFundsAndFailOnCross=1]="FailOnInsufficientFundsAndFailOnCross",n[n.SkipOnInsufficientFundsAndAmendOnCross=2]="SkipOnInsufficientFundsAndAmendOnCross",n[n.SkipOnInsufficientFundsAndFailOnCross=3]="SkipOnInsufficientFundsAndFailOnCross",n))(mi||{}),pi= exports.failedMultipleLimitOrderBehaviorBeet =di.fixedScalarEnum(mi);var rt=new _.FixableBeetArgsStruct([["bids",_.array(Ir)],["asks",_.array(Ir)],["clientOrderId",_.coption(_.u128)],["failedMultipleLimitOrderBehavior",pi]],"MultipleOrderPacket");var it=(i=>(i[i.Abort=0]="Abort",i[i.CancelProvide=1]="CancelProvide",i[i.DecrementTake=2]="DecrementTake",i))(it||{}),Kr= exports.selfTradeBehaviorBeet =gi.fixedScalarEnum(it);var Io=r=>r.__kind==="PostOnly",Bo= exports.isOrderPacketLimit =r=>r.__kind==="Limit",Mo= exports.isOrderPacketImmediateOrCancel =r=>r.__kind==="ImmediateOrCancel",Y= exports.orderPacketBeet =l.dataEnum([["PostOnly",new l.FixableBeetArgsStruct([["side",Z],["priceInTicks",l.u64],["numBaseLots",l.u64],["clientOrderId",l.u128],["rejectPostOnly",l.bool],["useOnlyDepositedFunds",l.bool],["lastValidSlot",l.coption(l.u64)],["lastValidUnixTimestampInSeconds",l.coption(l.u64)],["failSilentlyOnInsufficientFunds",l.bool]],'OrderPacketRecord["PostOnly"]')],["Limit",new l.FixableBeetArgsStruct([["side",Z],["priceInTicks",l.u64],["numBaseLots",l.u64],["selfTradeBehavior",Kr],["matchLimit",l.coption(l.u64)],["clientOrderId",l.u128],["useOnlyDepositedFunds",l.bool],["lastValidSlot",l.coption(l.u64)],["lastValidUnixTimestampInSeconds",l.coption(l.u64)],["failSilentlyOnInsufficientFunds",l.bool]],'OrderPacketRecord["Limit"]')],["ImmediateOrCancel",new l.FixableBeetArgsStruct([["side",Z],["priceInTicks",l.coption(l.u64)],["numBaseLots",l.u64],["numQuoteLots",l.u64],["minBaseLotsToFill",l.u64],["minQuoteLotsToFill",l.u64],["selfTradeBehavior",Kr],["matchLimit",l.coption(l.u64)],["clientOrderId",l.u128],["useOnlyDepositedFunds",l.bool],["lastValidSlot",l.coption(l.u64)],["lastValidUnixTimestampInSeconds",l.coption(l.u64)]],'OrderPacketRecord["ImmediateOrCancel"]')]]);var yi=new V.BeetArgsStruct([["index",V.u16],["orderSequenceNumber",V.u64],["clientOrderId",V.u128],["priceInTicks",V.u64],["baseLotsPlaced",V.u64]],"PlaceEvent");var fi=new j.BeetArgsStruct([["index",j.u16],["orderSequenceNumber",j.u64],["priceInTicks",j.u64],["baseLotsRemoved",j.u64],["baseLotsRemaining",j.u64]],"ReduceEvent");var ki=new X.BeetArgsStruct([["index",X.u16],["orderSequenceNumber",X.u64],["lastValidSlot",X.u64],["lastValidUnixTimestampInSeconds",X.u64]],"TimeInForceEvent");var Jo=r=>r.__kind==="Uninitialized",Yo= exports.isPhoenixMarketEventHeader =r=>r.__kind==="Header",Xo= exports.isPhoenixMarketEventFill =r=>r.__kind==="Fill",$o= exports.isPhoenixMarketEventPlace =r=>r.__kind==="Place",ea= exports.isPhoenixMarketEventReduce =r=>r.__kind==="Reduce",ta= exports.isPhoenixMarketEventEvict =r=>r.__kind==="Evict",ra= exports.isPhoenixMarketEventFillSummary =r=>r.__kind==="FillSummary",ia= exports.isPhoenixMarketEventFee =r=>r.__kind==="Fee",na= exports.isPhoenixMarketEventTimeInForce =r=>r.__kind==="TimeInForce",sa= exports.isPhoenixMarketEventExpiredOrder =r=>r.__kind==="ExpiredOrder",Pi= exports.phoenixMarketEventBeet =x.dataEnum([["Uninitialized",x.unit],["Header",new x.BeetArgsStruct([["fields",x.fixedSizeTuple([Yr])]],'PhoenixMarketEventRecord["Header"]')],["Fill",new x.BeetArgsStruct([["fields",x.fixedSizeTuple([oi])]],'PhoenixMarketEventRecord["Fill"]')],["Place",new x.BeetArgsStruct([["fields",x.fixedSizeTuple([yi])]],'PhoenixMarketEventRecord["Place"]')],["Reduce",new x.BeetArgsStruct([["fields",x.fixedSizeTuple([fi])]],'PhoenixMarketEventRecord["Reduce"]')],["Evict",new x.BeetArgsStruct([["fields",x.fixedSizeTuple([ti])]],'PhoenixMarketEventRecord["Evict"]')],["FillSummary",new x.BeetArgsStruct([["fields",x.fixedSizeTuple([ai])]],'PhoenixMarketEventRecord["FillSummary"]')],["Fee",new x.BeetArgsStruct([["fields",x.fixedSizeTuple([ni])]],'PhoenixMarketEventRecord["Fee"]')],["TimeInForce",new x.BeetArgsStruct([["fields",x.fixedSizeTuple([ki])]],'PhoenixMarketEventRecord["TimeInForce"]')],["ExpiredOrder",new x.BeetArgsStruct([["fields",x.fixedSizeTuple([ii])]],'PhoenixMarketEventRecord["ExpiredOrder"]')]]);var st=new nt.BeetArgsStruct([["baseParams",Je],["size",nt.u64]],"ReduceOrderParams");var la=new $.BeetArgsStruct([["discriminant",$.u64],["market",Fr.publicKey],["trader",Fr.publicKey],["approvalStatus",$.u64],["padding",$.uniformFixedSizeArray($.u64,6)]],"Seat");var wi=(i=>(i[i.NotApproved=0]="NotApproved",i[i.Approved=1]="Approved",i[i.Retired=2]="Retired",i))(wi||{}),da= exports.seatApprovalStatusBeet =hi.fixedScalarEnum(wi);var Si=new ee.FixableBeetArgsStruct([["quoteLotsToWithdraw",ee.coption(ee.u64)],["baseLotsToWithdraw",ee.coption(ee.u64)]],"WithdrawParams");var _bnjs = require('bn.js'); var _bnjs2 = _interopRequireDefault(_bnjs);function g(r){let e;return typeof r=="number"?e=r:e=r.toNumber(),e}function O(r){return typeof r=="number"?new (0, _bnjs2.default)(r):r.clone()}function ze(r){return r.lt(new (0, _bnjs2.default)(0))?-1:r.gt(new (0, _bnjs2.default)(0))?1:0}var _spltoken = require('@solana/spl-token'); var Fi = _interopRequireWildcard(_spltoken); var tn = _interopRequireWildcard(_spltoken); var rn = _interopRequireWildcard(_spltoken); var nn = _interopRequireWildcard(_spltoken); var sn = _interopRequireWildcard(_spltoken); var on = _interopRequireWildcard(_spltoken); var an = _interopRequireWildcard(_spltoken); var un = _interopRequireWildcard(_spltoken); var cn = _interopRequireWildcard(_spltoken); var ln = _interopRequireWildcard(_spltoken);var Lr=new I.BeetArgsStruct([["publicKey",xi.publicKey]],"PubkeyWrapper"),Ve=new I.BeetArgsStruct([["priceInTicks",I.u64],["orderSequenceNumber",I.u64]],"fIFOOrderId"),Ne=new I.BeetArgsStruct([["traderIndex",I.u64],["numBaseLots",I.u64],["lastValidSlot",I.u64],["lastValidUnixTimestampInSeconds",I.u64]],"fIFORestingOrder"),ot=new I.BeetArgsStruct([["quoteLotsLocked",I.u64],["quoteLotsFree",I.u64],["baseLotsLocked",I.u64],["baseLotsFree",I.u64],["padding",I.uniformFixedSizeArray(I.u64,8)]],"TraderState");function Ur(r,e,t,i){return f(this,null,function*(){let n=yield _spltoken.getAssociatedTokenAddress.call(void 0, i,e),s=yield r.getAccountInfo(n,"confirmed"),o=[];return(s===null||s.data.length==0)&&o.push(_spltoken.createAssociatedTokenAccountInstruction.call(void 0, t,n,e,i)),o})}var Ya=new at.BeetArgsStruct([["instructionDiscriminator",at.u8]],"AddDesignatedMarketMakerInstructionArgs");var $a=new ut.BeetArgsStruct([["instructionDiscriminator",ut.u8]],"ChangeMarketFeeRecipientInstructionArgs");var iu=new ct.BeetArgsStruct([["instructionDiscriminator",ct.u8],["marketStatus",bi]],"ChangeMarketStatusInstructionArgs");var ou=new lt.BeetArgsStruct([["instructionDiscriminator",lt.u8]],"ClaimMarketAuthorityInstructionArgs");var Bn=new bt.BeetArgsStruct([["instructionDiscriminator",bt.u8]],"ClaimSeatInstructionArgs"),Mn=1;function Mi(r,e=new Ue.PublicKey("PSMxQbAoDWDbvd9ezQJgARyq6R9L5kJAasaLDVcZwf1")){var s;let[t]=Bn.serialize({instructionDiscriminator:Mn}),i=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.seatManager,isWritable:!0,isSigner:!1},{pubkey:r.seatDepositCollector,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.payer,isWritable:!0,isSigner:!0},{pubkey:r.seat,isWritable:!0,isSigner:!1},{pubkey:(s=r.systemProgram)!=null?s:Ue.SystemProgram.programId,isWritable:!1,isSigner:!1}];return new Ue.TransactionInstruction({programId:e,keys:i,data:t})}var cu=new dt.BeetArgsStruct([["instructionDiscriminator",dt.u8]],"ClaimSeatAuthorizedInstructionArgs");var bu=new mt.BeetArgsStruct([["instructionDiscriminator",mt.u8]],"ClaimSeatManagerAuthorityInstructionArgs");var mu=new pt.BeetArgsStruct([["instructionDiscriminator",pt.u8]],"ConfirmRenounceSeatManagerAuthorityInstructionArgs");var Tn=new gt.BeetArgsStruct([["instructionDiscriminator",gt.u8]],"EvictSeatInstructionArgs"),Kn=3;function Oi(r,e=new We.PublicKey("PSMxQbAoDWDbvd9ezQJgARyq6R9L5kJAasaLDVcZwf1")){var s,o;let[t]=Tn.serialize({instructionDiscriminator:Kn}),i=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.seatManager,isWritable:!0,isSigner:!1},{pubkey:r.seatDepositCollector,isWritable:!0,isSigner:!1},{pubkey:r.baseMint,isWritable:!1,isSigner:!1},{pubkey:r.quoteMint,isWritable:!1,isSigner:!1},{pubkey:r.baseVault,isWritable:!0,isSigner:!1},{pubkey:r.quoteVault,isWritable:!0,isSigner:!1},{pubkey:r.associatedTokenAccountProgram,isWritable:!1,isSigner:!1},{pubkey:(s=r.tokenProgram)!=null?s:Fi.TOKEN_PROGRAM_ID,isWritable:!1,isSigner:!1},{pubkey:(o=r.systemProgram)!=null?o:We.SystemProgram.programId,isWritable:!1,isSigner:!1},{pubkey:r.signer,isWritable:!1,isSigner:!0},{pubkey:r.trader,isWritable:!0,isSigner:!1},{pubkey:r.seat,isWritable:!1,isSigner:!1},{pubkey:r.baseAccount,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccount,isWritable:!0,isSigner:!1},{pubkey:r.baseAccountBackup,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccountBackup,isWritable:!0,isSigner:!1}];return new We.TransactionInstruction({programId:e,keys:i,data:t})}var yu=new yt.BeetArgsStruct([["instructionDiscriminator",yt.u8],["successor",Ui.publicKey]],"NameMarketAuthoritySuccessorInstructionArgs");var Pu=new ft.BeetArgsStruct([["instructionDiscriminator",ft.u8]],"NameSuccessorInstructionArgs");var wu=new kt.BeetArgsStruct([["instructionDiscriminator",kt.u8]],"RemoveDesignatedMarketMakerInstructionArgs");var On="PSMxQbAoDWDbvd9ezQJgARyq6R9L5kJAasaLDVcZwf1",Cr=new (0, _web3js.PublicKey)(On);function Ln(r){return Un.deserialize(r,0)[0]}var Un=new C.BeetArgsStruct([["market",Qe.publicKey],["authority",Qe.publicKey],["successor",Qe.publicKey],["numMakers",C.u64],["_headerPadding",C.uniformFixedSizeArray(C.u64,11)],["designatedMarketMaker",C.uniformFixedSizeArray(Qe.publicKey,128)],["_dmmPadding",C.uniformFixedSizeArray(C.u128,128)]],"SeatManagerData");function Rr(r){return _web3js.PublicKey.findProgramAddressSync([r.toBuffer()],Cr)[0]}function Di(r){return _web3js.PublicKey.findProgramAddressSync([r.toBuffer(),Buffer.from("deposit")],Cr)[0]}function Ri(r,e){let t=Rr(r),i=Di(r),n=ie(r,e),s=p();return Mi({phoenixProgram:b,logAuthority:s,market:r,seatManager:t,seatDepositCollector:i,trader:e,payer:e,seat:n})}function qi(r,e,t,i,n){let s=Rr(r.address),o=Di(r.address),a=ie(r.address,e),u=p(),c=_web3js.PublicKey.findProgramAddressSync([e.toBuffer(),_spltoken.TOKEN_PROGRAM_ID.toBuffer(),r.data.header.baseParams.mintKey.toBuffer()],_spltoken.ASSOCIATED_TOKEN_PROGRAM_ID)[0],m=_web3js.PublicKey.findProgramAddressSync([e.toBuffer(),_spltoken.TOKEN_PROGRAM_ID.toBuffer(),r.data.header.quoteParams.mintKey.toBuffer()],_spltoken.ASSOCIATED_TOKEN_PROGRAM_ID)[0],d={phoenixProgram:b,logAuthority:u,market:r.address,seatManager:s,seatDepositCollector:o,baseMint:r.data.header.baseParams.mintKey,quoteMint:r.data.header.quoteParams.mintKey,baseVault:r.data.header.baseParams.vaultKey,quoteVault:r.data.header.quoteParams.vaultKey,associatedTokenAccountProgram:_spltoken.ASSOCIATED_TOKEN_PROGRAM_ID,signer:t,trader:e,seat:a,baseAccount:c,quoteAccount:m,baseAccountBackup:i!=null?i:_web3js.PublicKey.default,quoteAccountBackup:n!=null?n:_web3js.PublicKey.default};return Oi(d)}function qr(r,e,t){return f(this,null,function*(){let i=e.getSeatAddress(t),n=[],s;try{s=yield r.getAccountInfo(i,"confirmed")}catch(o){s=null}if(s===null||s.data.length==0){let o=yield vi(r,e);o&&n.push(qi(e,o,t)),n.push(Ri(e.address,t))}return n})}function ju(r,e,t){return f(this,null,function*(){let i=[],n=yield vi(r,e);return n&&i.push(qi(e,n,t)),i.push(Ri(e.address,t)),i})}function vi(r,e){return f(this,null,function*(){var o;let t=e.data.traders,i=Rr(e.address),n=(o=yield r.getAccountInfo(i,"confirmed"))==null?void 0:o.data;if(!n)throw new Error(`Failed to load seat manager account ${i}`);let s=Ln(n);if(t.size>=Number(e.data.header.marketSizeParams.numSeats)){for(let[a,u]of t)if(u.baseLotsLocked==0&&u.quoteLotsLocked==0){if(s.designatedMarketMaker.includes(new (0, _web3js.PublicKey)(a)))continue;return new (0, _web3js.PublicKey)(a)}}})}var re=10,ne= exports.DEFAULT_L3_BOOK_DEPTH =20,ji= exports.DEFAULT_MATCH_LIMIT =2048,zr= exports.DEFAULT_SLIPPAGE_PERCENT =.005;function ie(r,e){return _web3js.PublicKey.findProgramAddressSync([Buffer.from("seat"),r.toBuffer(),e.toBuffer()],b)[0]}function je(r){let e=Tr.byteSize,[t]=Tr.deserialize(r.subarray(0,e)),i=8*32,n=r.subarray(e+i);e=0;let s=Number(n.readBigUInt64LE(e));e+=8;let o=Number(n.readBigUInt64LE(e));e+=8;let a=Number(n.readBigUInt64LE(e));e+=8;let u=Number(n.readBigUInt64LE(e));e+=8;let c=Number(n.readBigUInt64LE(e));e+=8;let m=Number(n.readBigUInt64LE(e));e+=8,n=n.subarray(e);let d=g(t.marketSizeParams.bidsSize),P=g(t.marketSizeParams.asksSize),h=g(t.marketSizeParams.numSeats),K=16+16+(16+Ve.byteSize+Ne.byteSize)*d,A=16+16+(16+Ve.byteSize+Ne.byteSize)*P,M=16+16+(16+32+ot.byteSize)*h;e=0;let y=n.subarray(e,e+K);e+=K;let B=n.subarray(e,e+A);e+=A;let U=n.subarray(e,e+M),Ce=vr(y,Ve,Ne),kn=vr(B,Ve,Ne),Pn=[...Ce].sort((R,q)=>{let De=ze(O(q[0].priceInTicks).sub(O(R[0].priceInTicks)));return De!==0?De:ze(_e(R[0]).sub(_e(q[0])))}),hn=[...kn].sort((R,q)=>{let De=ze(O(R[0].priceInTicks).sub(O(q[0].priceInTicks)));return De!==0?De:ze(_e(R[0]).sub(_e(q[0])))}),jr=new Map;for(let[R,q]of vr(U,Lr,ot))jr.set(R.publicKey.toString(),q);let Gr=new Map,Zr=new Map;for(let[R,q]of Dn(U,Lr,ot))Gr.set(R.publicKey.toString(),q),Zr.set(q,R.publicKey.toString());return{header:t,baseLotsPerBaseUnit:s,quoteLotsPerBaseUnitPerTick:o,orderSequenceNumber:a,takerFeeBps:u,collectedQuoteLotFees:c,unclaimedQuoteLotFees:m,bids:Pn,asks:hn,traders:jr,traderPubkeyToTraderIndex:Gr,traderIndexToTraderPubkey:Zr}}function vr(r,e,t){let i=new Map,n=Gi(r,e,t),s=n[0],o=n[1];for(let[a,[u,c]]of s.entries())o.has(a)||i.set(u,c);return i}function Dn(r,e,t){let i=new Map,n=Gi(r,e,t),s=n[0],o=n[1];for(let[a,[u]]of s.entries())o.has(a)||i.set(u,a+1);return i}function _e(r){let e=r.orderSequenceNumber.fromTwos(64);return e.isNeg()?e.neg().sub(new (0, _bnjs2.default)(1)):e}function Rn(r){let e=r.orderSequenceNumber;return r.side===0&&(e=e.add(O(1)).neg().toTwos(64)),e}function gc(r){return{side:r.side,orderSequenceNumber:Rn(r),priceInTicks:r.priceInTicks}}function Gi(r,e,t){let i=0,n=e.byteSize,s=t.byteSize,o=new Array;i+=16,i+=8;let a=r.readInt32LE(i);i+=4;let u=r.readInt32LE(i);i+=4;let c=new Array;for(let h=0;i<r.length&&h<a-1;h++){let K=new Array;for(let y=0;y<4;y++)K.push(r.readInt32LE(i)),i+=4;let[A]=e.deserialize(r.subarray(i,i+n));i+=n;let[M]=t.deserialize(r.subarray(i,i+s));i+=s,o.push([A,M]),c.push([h,K[0]])}let m=new Set,d=u-1,P=0;for(;u<a;)if([d,u]=c[u-1],m.add(d),P+=1,P>a)throw new Error("Infinite loop detected");return[o,m]}function yc(r,e,t,i=re){return r.getLadder(e,t,i)}function fc(r,e,t){return r.levelToUiLevel(e,t)}function Vr(r,e=re,t=0,i=0){return r.getUiLadder(e,t,i)}function Zi(r){let e=r.bids,t=r.asks,n=Math.max(...e.map(o=>o.quantity),...t.map(o=>o.quantity)).toString().length,s=(o,a,u)=>{let c=o.toFixed(3),m=a.toFixed(2).padStart(n," ");console.log(c+`\x1B[3${u==="green"?2:1}m`+m+"\x1B[0m")};console.log("\x1B[30mAsks\x1B[0m");for(let{price:o,quantity:a}of t.reverse())s(o,a,"red");console.log("\x1B[30mBids\x1B[0m");for(let{price:o,quantity:a}of e)s(o,a,"green")}function ht(r,e,t,i=ne){let n=[],s=[];for(let o of[1,0]){let a=o===1?r.asks:r.bids;for(let[u,c]of a){if(c.lastValidSlot!=0&&c.lastValidSlot<e||c.lastValidUnixTimestampInSeconds!=0&&c.lastValidUnixTimestampInSeconds<t)continue;let m=O(u.priceInTicks),d=O(c.numBaseLots),P=r.traderIndexToTraderPubkey.get(g(c.traderIndex));if(!P)throw new Error(`Invalid trader index: ${c.traderIndex.toString()}`);let h={priceInTicks:m,sizeInBaseLots:d,side:o,makerPubkey:P,orderSequenceNumber:_e(u),lastValidSlot:O(c.lastValidSlot),lastValidUnixTimestampInSeconds:O(c.lastValidUnixTimestampInSeconds)};if(o===1?s.push(h):n.push(h),o===1&&s.length===i||o===0&&n.length===i)break}}return{asks:s,bids:n}}function Nr(r,e=ne,t=0,i=0){let n=ht(r,t,i,e);return{bids:n.bids.map(s=>_i(s,r)),asks:n.asks.map(s=>_i(s,r))}}function _i(r,e){return{price:g(r.priceInTicks)*e.quoteLotsPerBaseUnitPerTick*g(e.header.quoteLotSize)/(T(10,e.header.quoteParams.decimals)*e.header.rawBaseUnitsPerBaseUnit),side:r.side,size:g(r.sizeInBaseLots)*e.header.rawBaseUnitsPerBaseUnit/e.baseLotsPerBaseUnit,makerPubkey:r.makerPubkey,orderSequenceNumber:r.orderSequenceNumber.toString(),lastValidSlot:g(r.lastValidSlot),lastValidUnixTimestampInSeconds:g(r.lastValidUnixTimestampInSeconds)}}function kc({market:r,trader:e,side:t,inAmount:i,slippage:n=zr,clientOrderId:s=0,idempotent:o=!1}){let a=r.data.header.quoteParams.mintKey,u=r.data.header.baseParams.mintKey,c=r.getBaseAccountKey(e),m=r.getQuoteAccountKey(e),d=new _web3js.Transaction;(u.equals(_spltoken.NATIVE_MINT)||o)&&d.add(_spltoken.createAssociatedTokenAccountIdempotentInstruction.call(void 0, e,c,e,u,_spltoken.TOKEN_PROGRAM_ID,_spltoken.ASSOCIATED_TOKEN_PROGRAM_ID)),(a.equals(_spltoken.NATIVE_MINT)||o)&&d.add(_spltoken.createAssociatedTokenAccountIdempotentInstruction.call(void 0, e,m,e,a,_spltoken.TOKEN_PROGRAM_ID,_spltoken.ASSOCIATED_TOKEN_PROGRAM_ID));let P=r.getSwapOrderPacket({side:t,inAmount:i,slippage:n,clientOrderId:s}),h=r.createSwapInstruction(P,e);return d.add(h),u.equals(_spltoken.NATIVE_MINT)&&d.add(_spltoken.createCloseAccountInstruction.call(void 0, c,e,e)),a.equals(_spltoken.NATIVE_MINT)&&d.add(_spltoken.createCloseAccountInstruction.call(void 0, m,e,e)),d}function Qr({uiLadder:r,side:e,takerFeeBps:t,inAmount:i}){return e==0?qn({uiLadder:r,takerFeeBps:t,quoteUnitsIn:i}):vn({uiLadder:r,takerFeeBps:t,rawBaseUnitsIn:i})}function Hi({uiLadder:r,side:e,takerFeeBps:t,outAmount:i}){return e==0?Vn({uiLadder:r,takerFeeBps:t,rawBaseUnitsOut:i}):zn({uiLadder:r,takerFeeBps:t,quoteUnitsOut:i})}function qn({uiLadder:r,takerFeeBps:e,quoteUnitsIn:t}){return Ji({sideOfBook:r.asks,quoteAmountBudget:t/(1+e/1e4)})}function vn({uiLadder:r,takerFeeBps:e,rawBaseUnitsIn:t}){return Yi({sideOfBook:r.bids,baseAmountBudget:t})*(1-e/1e4)}function zn({uiLadder:r,takerFeeBps:e,quoteUnitsOut:t}){return Ji({sideOfBook:r.bids,quoteAmountBudget:t/(1-e/1e4)})}function Vn({uiLadder:r,takerFeeBps:e,rawBaseUnitsOut:t}){return Yi({sideOfBook:r.asks,baseAmountBudget:t})*(1+e/1e4)}function Ji({sideOfBook:r,quoteAmountBudget:e}){let t=e,i=0;for(let{price:n,quantity:s}of r)if(n*s>=t){i+=t/n,t=0;break}else i+=s,t-=n*s;return i}function Yi({sideOfBook:r,baseAmountBudget:e}){let t=e,i=0;for(let{price:n,quantity:s}of r)if(s>=t){i+=t*n,t=0;break}else i+=s*n,t-=s;return i}function Nn(r,e,t){return f(this,null,function*(){let i=yield Ur(r,t,t,e.data.header.baseParams.mintKey),n=yield Ur(r,t,t,e.data.header.quoteParams.mintKey),s=yield qr(r,e,t);return[...i,...n,...s]})}function Pc(r,e,t,i){return f(this,null,function*(){let n=yield Nn(r,e,t);return n.push(e.createPlaceLimitOrderInstruction(i,t)),n})}function hc(r,e,t,i){return f(this,null,function*(){let n=[],s=yield qr(r,e,t);return n.push(...s),n.push(e.createPlaceLimitOrderInstruction(i,t)),n})}function wt(r){return f(this,null,function*(){let e=yield r.getGenesisHash();return e==="5eykt4UsFv8P8NJdTREpY1vzqKqZKvdpKuc147dw2N9d"?"mainnet-beta":e==="EtWTRABZaYq6iMfeYKouRu166VU2xqa1wcaWoxPkrZBG"?"devnet":"localhost"})}function Ge(r){let[e]=Qn.deserialize(r,0);return e}var Qn=new G.BeetArgsStruct([["slot",G.u64],["epochStartTime",G.i64],["epoch",G.u64],["leaderScheduleEpoch",G.u64],["unixTimestamp",G.i64]],"ClockData");var _zstddec = require('zstddec');var en=1723488*2,se= exports.getConfirmedMarketsAndClockAccounts =(r,e,t="confirmed")=>f(void 0,null,function*(){let i=(yield r.getMultipleAccountsInfo([...e,_web3js.SYSVAR_CLOCK_PUBKEY],t)).map(n=>n==null?void 0:n.data);if(i.some(n=>n===void 0))throw new Error("Unable to get account data");return i}),oe= exports.getConfirmedMarketsAndClockAccountsZstd =(r,e,t="confirmed")=>f(void 0,null,function*(){var m;let i={jsonrpc:"2.0",id:1,method:"getMultipleAccounts",params:[[...e.map(d=>d.toBase58()),_web3js.SYSVAR_CLOCK_PUBKEY.toBase58()],{encoding:"base64+zstd",commitment:t}]},s=(yield(yield fetch(r.rpcEndpoint,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}})).json()).result.value,o=new _zstddec.ZSTDDecoder;yield o.init();let a=Buffer.from((m=s.pop())==null?void 0:m.data[0],"base64");if(a===void 0)throw new Error("Unable to get clock account data");let u=Buffer.from(o.decode(a)),c=[];for(let d of s){if((d==null?void 0:d.data[0])===void 0)throw new Error("Unable to get market account data");let P=Buffer.from(d.data[0],"base64"),h=Buffer.from(o.decode(P,en));c.push(h)}return[...c,u]}),Fc= exports.getConfirmedMarketAccountZstd =(r,e,t="confirmed")=>f(void 0,null,function*(){let i={jsonrpc:"2.0",id:1,method:"getAccountInfo",params:[e.toBase58(),{encoding:"base64+zstd",commitment:t}]},s=(yield(yield fetch(r.rpcEndpoint,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}})).json()).result.value;if((s==null?void 0:s.data[0])===void 0)throw new Error("Unable to get market account data");let o=Buffer.from(s==null?void 0:s.data[0],"base64"),a=new _zstddec.ZSTDDecoder;yield a.init();let u=a.decode(o,en);return Buffer.from(u)});var _n=new St.BeetArgsStruct([["instructionDiscriminator",St.u8]],"CancelAllOrdersInstructionArgs"),jn= exports.cancelAllOrdersInstructionDiscriminator =6;function At(r,e=new xt.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){var s;let[t]=_n.serialize({instructionDiscriminator:jn}),i=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.baseAccount,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccount,isWritable:!0,isSigner:!1},{pubkey:r.baseVault,isWritable:!0,isSigner:!1},{pubkey:r.quoteVault,isWritable:!0,isSigner:!1},{pubkey:(s=r.tokenProgram)!=null?s:tn.TOKEN_PROGRAM_ID,isWritable:!1,isSigner:!1}];return new xt.TransactionInstruction({programId:e,keys:i,data:t})}var Gn=new It.BeetArgsStruct([["instructionDiscriminator",It.u8]],"CancelAllOrdersWithFreeFundsInstructionArgs"),Zn= exports.cancelAllOrdersWithFreeFundsInstructionDiscriminator =7;function Mt(r,e=new Bt.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){let[t]=Gn.serialize({instructionDiscriminator:Zn}),i=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0}];return new Bt.TransactionInstruction({programId:e,keys:i,data:t})}var Hn=new Tt.FixableBeetArgsStruct([["instructionDiscriminator",Tt.u8],["params",Xe]],"CancelMultipleOrdersByIdInstructionArgs"),Jn= exports.cancelMultipleOrdersByIdInstructionDiscriminator =10;function Ft(r,e,t=new Kt.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){var o;let[i]=Hn.serialize(k({instructionDiscriminator:Jn},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.baseAccount,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccount,isWritable:!0,isSigner:!1},{pubkey:r.baseVault,isWritable:!0,isSigner:!1},{pubkey:r.quoteVault,isWritable:!0,isSigner:!1},{pubkey:(o=r.tokenProgram)!=null?o:rn.TOKEN_PROGRAM_ID,isWritable:!1,isSigner:!1}];return new Kt.TransactionInstruction({programId:t,keys:n,data:i})}var Yn=new Ot.FixableBeetArgsStruct([["instructionDiscriminator",Ot.u8],["params",Xe]],"CancelMultipleOrdersByIdWithFreeFundsInstructionArgs"),Xn= exports.cancelMultipleOrdersByIdWithFreeFundsInstructionDiscriminator =11;function Ut(r,e,t=new Lt.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){let[i]=Yn.serialize(k({instructionDiscriminator:Xn},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0}];return new Lt.TransactionInstruction({programId:t,keys:n,data:i})}var $n=new Wt.FixableBeetArgsStruct([["instructionDiscriminator",Wt.u8],["params",$e]],"CancelUpToInstructionArgs"),es= exports.cancelUpToInstructionDiscriminator =8;function Ct(r,e,t=new Et.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){var o;let[i]=$n.serialize(k({instructionDiscriminator:es},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.baseAccount,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccount,isWritable:!0,isSigner:!1},{pubkey:r.baseVault,isWritable:!0,isSigner:!1},{pubkey:r.quoteVault,isWritable:!0,isSigner:!1},{pubkey:(o=r.tokenProgram)!=null?o:nn.TOKEN_PROGRAM_ID,isWritable:!1,isSigner:!1}];return new Et.TransactionInstruction({programId:t,keys:n,data:i})}var ts=new Dt.FixableBeetArgsStruct([["instructionDiscriminator",Dt.u8],["params",$e]],"CancelUpToWithFreeFundsInstructionArgs"),rs= exports.cancelUpToWithFreeFundsInstructionDiscriminator =9;function qt(r,e,t=new Rt.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){let[i]=ts.serialize(k({instructionDiscriminator:rs},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0}];return new Rt.TransactionInstruction({programId:t,keys:n,data:i})}var is=new vt.BeetArgsStruct([["instructionDiscriminator",vt.u8],["depositFundsParams",$r]],"DepositFundsInstructionArgs"),ns= exports.depositFundsInstructionDiscriminator =13;function Vt(r,e,t=new zt.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){var o;let[i]=is.serialize(k({instructionDiscriminator:ns},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.seat,isWritable:!1,isSigner:!1},{pubkey:r.baseAccount,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccount,isWritable:!0,isSigner:!1},{pubkey:r.baseVault,isWritable:!0,isSigner:!1},{pubkey:r.quoteVault,isWritable:!0,isSigner:!1},{pubkey:(o=r.tokenProgram)!=null?o:sn.TOKEN_PROGRAM_ID,isWritable:!1,isSigner:!1}];return new zt.TransactionInstruction({programId:t,keys:n,data:i})}var ss=new Nt.BeetArgsStruct([["instructionDiscriminator",Nt.u8]],"LogInstructionArgs"),_r= exports.logInstructionDiscriminator =15;function ul(r,e=new Qt.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){let[t]=ss.serialize({instructionDiscriminator:_r}),i=[{pubkey:r.logAuthority,isWritable:!1,isSigner:!0}];return new Qt.TransactionInstruction({programId:e,keys:i,data:t})}var os=new _t.FixableBeetArgsStruct([["instructionDiscriminator",_t.u8],["orderPacket",Y]],"PlaceLimitOrderInstructionArgs"),as= exports.placeLimitOrderInstructionDiscriminator =2;function Gt(r,e,t=new jt.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){var o;let[i]=os.serialize(k({instructionDiscriminator:as},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.seat,isWritable:!1,isSigner:!1},{pubkey:r.baseAccount,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccount,isWritable:!0,isSigner:!1},{pubkey:r.baseVault,isWritable:!0,isSigner:!1},{pubkey:r.quoteVault,isWritable:!0,isSigner:!1},{pubkey:(o=r.tokenProgram)!=null?o:on.TOKEN_PROGRAM_ID,isWritable:!1,isSigner:!1}];return new jt.TransactionInstruction({programId:t,keys:n,data:i})}var us=new Zt.FixableBeetArgsStruct([["instructionDiscriminator",Zt.u8],["orderPacket",Y]],"PlaceLimitOrderWithFreeFundsInstructionArgs"),cs= exports.placeLimitOrderWithFreeFundsInstructionDiscriminator =3;function Jt(r,e,t=new Ht.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){let[i]=us.serialize(k({instructionDiscriminator:cs},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.seat,isWritable:!1,isSigner:!1}];return new Ht.TransactionInstruction({programId:t,keys:n,data:i})}var ls=new Yt.FixableBeetArgsStruct([["instructionDiscriminator",Yt.u8],["multipleOrderPacket",rt]],"PlaceMultiplePostOnlyOrdersInstructionArgs"),bs= exports.placeMultiplePostOnlyOrdersInstructionDiscriminator =16;function $t(r,e,t=new Xt.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){var o;let[i]=ls.serialize(k({instructionDiscriminator:bs},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.seat,isWritable:!1,isSigner:!1},{pubkey:r.baseAccount,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccount,isWritable:!0,isSigner:!1},{pubkey:r.baseVault,isWritable:!0,isSigner:!1},{pubkey:r.quoteVault,isWritable:!0,isSigner:!1},{pubkey:(o=r.tokenProgram)!=null?o:an.TOKEN_PROGRAM_ID,isWritable:!1,isSigner:!1}];return new Xt.TransactionInstruction({programId:t,keys:n,data:i})}var ds=new er.FixableBeetArgsStruct([["instructionDiscriminator",er.u8],["multipleOrderPacket",rt]],"PlaceMultiplePostOnlyOrdersWithFreeFundsInstructionArgs"),ms= exports.placeMultiplePostOnlyOrdersWithFreeFundsInstructionDiscriminator =17;function rr(r,e,t=new tr.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){let[i]=ds.serialize(k({instructionDiscriminator:ms},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.seat,isWritable:!1,isSigner:!1}];return new tr.TransactionInstruction({programId:t,keys:n,data:i})}var ps=new ir.BeetArgsStruct([["instructionDiscriminator",ir.u8],["params",st]],"ReduceOrderInstructionArgs"),gs= exports.reduceOrderInstructionDiscriminator =4;function sr(r,e,t=new nr.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){var o;let[i]=ps.serialize(k({instructionDiscriminator:gs},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.baseAccount,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccount,isWritable:!0,isSigner:!1},{pubkey:r.baseVault,isWritable:!0,isSigner:!1},{pubkey:r.quoteVault,isWritable:!0,isSigner:!1},{pubkey:(o=r.tokenProgram)!=null?o:un.TOKEN_PROGRAM_ID,isWritable:!1,isSigner:!1}];return new nr.TransactionInstruction({programId:t,keys:n,data:i})}var ys=new or.BeetArgsStruct([["instructionDiscriminator",or.u8],["params",st]],"ReduceOrderWithFreeFundsInstructionArgs"),fs= exports.reduceOrderWithFreeFundsInstructionDiscriminator =5;function ur(r,e,t=new ar.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){let[i]=ys.serialize(k({instructionDiscriminator:fs},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!0,isSigner:!0}];return new ar.TransactionInstruction({programId:t,keys:n,data:i})}var ks=new cr.BeetArgsStruct([["instructionDiscriminator",cr.u8]],"RequestSeatInstructionArgs"),Ps= exports.requestSeatInstructionDiscriminator =14;function lr(r,e=new Ee.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){var s;let[t]=ks.serialize({instructionDiscriminator:Ps}),i=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.payer,isWritable:!0,isSigner:!0},{pubkey:r.seat,isWritable:!0,isSigner:!1},{pubkey:(s=r.systemProgram)!=null?s:Ee.SystemProgram.programId,isWritable:!1,isSigner:!1}];return new Ee.TransactionInstruction({programId:e,keys:i,data:t})}var hs=new br.FixableBeetArgsStruct([["instructionDiscriminator",br.u8],["orderPacket",Y]],"SwapInstructionArgs"),ws= exports.swapInstructionDiscriminator =0;function mr(r,e,t=new dr.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){var o;let[i]=hs.serialize(k({instructionDiscriminator:ws},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.baseAccount,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccount,isWritable:!0,isSigner:!1},{pubkey:r.baseVault,isWritable:!0,isSigner:!1},{pubkey:r.quoteVault,isWritable:!0,isSigner:!1},{pubkey:(o=r.tokenProgram)!=null?o:cn.TOKEN_PROGRAM_ID,isWritable:!1,isSigner:!1}];return new dr.TransactionInstruction({programId:t,keys:n,data:i})}var Ss=new pr.FixableBeetArgsStruct([["instructionDiscriminator",pr.u8],["orderPacket",Y]],"SwapWithFreeFundsInstructionArgs"),xs= exports.swapWithFreeFundsInstructionDiscriminator =1;function yr(r,e,t=new gr.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){let[i]=Ss.serialize(k({instructionDiscriminator:xs},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.seat,isWritable:!1,isSigner:!1}];return new gr.TransactionInstruction({programId:t,keys:n,data:i})}var As=new fr.FixableBeetArgsStruct([["instructionDiscriminator",fr.u8],["withdrawFundsParams",Si]],"WithdrawFundsInstructionArgs"),Is= exports.withdrawFundsInstructionDiscriminator =12;function Pr(r,e,t=new kr.PublicKey("PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY")){var o;let[i]=As.serialize(k({instructionDiscriminator:Is},e)),n=[{pubkey:r.phoenixProgram,isWritable:!1,isSigner:!1},{pubkey:r.logAuthority,isWritable:!1,isSigner:!1},{pubkey:r.market,isWritable:!0,isSigner:!1},{pubkey:r.trader,isWritable:!1,isSigner:!0},{pubkey:r.baseAccount,isWritable:!0,isSigner:!1},{pubkey:r.quoteAccount,isWritable:!0,isSigner:!1},{pubkey:r.baseVault,isWritable:!0,isSigner:!1},{pubkey:r.quoteVault,isWritable:!0,isSigner:!1},{pubkey:(o=r.tokenProgram)!=null?o:ln.TOKEN_PROGRAM_ID,isWritable:!1,isSigner:!1}];return new kr.TransactionInstruction({programId:t,keys:n,data:i})}var _borsh = require('borsh');var _bs58 = require('bs58'); var _bs582 = _interopRequireDefault(_bs58);var Ks=new hr.FixableBeetArgsStruct([["events",hr.array(Pi)]],"PhoenixEvents");function Fs(r){let e=Buffer.from(r),[t]=Ks.deserialize(e,0);return t.events}function bn(r){return new (0, _web3js.PublicKey)(r.readFixedArray(32))}function Os(r){let e=new (0, _borsh.BinaryReader)(Buffer.from(r));if(e.readU8()!=1)throw new Error("early Unexpected event");let i={instruction:e.readU8(),sequenceNumber:e.readU64(),timestamp:e.readU64(),slot:e.readU64(),market:bn(e),signer:bn(e),totalEvents:e.readU16()},n=new ArrayBuffer(4);new DataView(n).setUint16(0,i.totalEvents,!0);let o=Fs(Buffer.concat([Buffer.from(n),Buffer.from(r.slice(e.offset))]));return{header:i,events:o}}function dn(r){var s;let e=r==null?void 0:r.meta;if(e===void 0)return{instructions:[],txReceived:!1,txFailed:!0};if((e==null?void 0:e.err)!==null)return{instructions:[],txReceived:!0,txFailed:!0};let t=(s=r==null?void 0:r.meta)==null?void 0:s.innerInstructions;if(!t||!r||!r.slot)return{instructions:[],txReceived:!0,txFailed:!0};let i=[];for(let o of t)for(let a of o.instructions){if(a.programId.toBase58()!=b.toBase58())continue;let u=_bs582.default.decode(a.data);u[0]==_r&&i.push(u.slice(1))}let n=new Array;for(let o of i)n.push(Os(o));return{instructions:n,signature:r.transaction.signatures[0],txReceived:!0,txFailed:!1}}function Ab(r,e){return f(this,null,function*(){let t=yield r.getParsedTransaction(e,{commitment:"confirmed",maxSupportedTransactionVersion:1});if(t===null)throw new Error(`Transaction ${e} not found`);return dn(t)})}function Ib(r,e){return f(this,null,function*(){let t=yield r.getParsedTransaction(e,{commitment:"confirmed",maxSupportedTransactionVersion:1});if(t===null)throw new Error(`Transaction ${e} not found`);return dn(t)})}var D=class{constructor({address:e,data:t}){this.address=e,this.data=t}static load({address:e,buffer:t}){let i=je(t);return new D({address:e,data:i})}static loadFromAddress(n){return f(this,arguments,function*({connection:e,address:t,tokenList:i}){let s=yield e.getAccountInfo(t,"confirmed").then(o=>o==null?void 0:o.data);if(s===void 0)throw new Error(`Failed to load ${t}`);return i?D.load({address:t,buffer:s}):new D({address:t,data:je(s)})})}reload(e){let t=je(e);return this.data=t,this}reloadFromNetwork(e){return f(this,null,function*(){let t=yield e.getAccountInfo(this.address,"confirmed").then(n=>n==null?void 0:n.data);if(!t)throw new Error(`Failed to reload ${this.address}`);let i=je(t);this.data=i})}getMarketSequenceNumber(){return g(this.data.header.marketSequenceNumber)}getBaseAccountKey(e){return _spltoken.getAssociatedTokenAddressSync.call(void 0, this.data.header.baseParams.mintKey,e,!0)}getQuoteAccountKey(e){return _spltoken.getAssociatedTokenAddressSync.call(void 0, this.data.header.quoteParams.mintKey,e,!0)}getQuoteVaultKey(){return this.data.header.quoteParams.vaultKey}getBaseVaultKey(){return this.data.header.baseParams.vaultKey}getSeatAddress(e){return ie(this.address,e)}getUiLadder(e=re,t=0,i=0){let n=this.getLadder(t,i,e);return{bids:n.bids.map(({priceInTicks:s,sizeInBaseLots:o})=>this.levelToUiLevel(g(s),g(o))),asks:n.asks.map(({priceInTicks:s,sizeInBaseLots:o})=>this.levelToUiLevel(g(s),g(o)))}}getLadder(e,t,i=re){let n=[],s=[];for(let[o,a]of this.data.bids){if(a.lastValidSlot!=0&&a.lastValidSlot<e||a.lastValidUnixTimestampInSeconds!=0&&a.lastValidUnixTimestampInSeconds<t)continue;let u=O(o.priceInTicks),c=O(a.numBaseLots);if(n.length===0)n.push({priceInTicks:u,sizeInBaseLots:c});else{let m=n[n.length-1];if(!m)throw Error;if(u.eq(m.priceInTicks))m.sizeInBaseLots=m.sizeInBaseLots.add(c);else{if(n.length===i)break;n.push({priceInTicks:u,sizeInBaseLots:c})}}}for(let[o,a]of this.data.asks){if(a.lastValidSlot!=0&&a.lastValidSlot<e||a.lastValidUnixTimestampInSeconds!=0&&a.lastValidUnixTimestampInSeconds<t)continue;let u=O(o.priceInTicks),c=O(a.numBaseLots);if(s.length===0)s.push({priceInTicks:u,sizeInBaseLots:c});else{let m=s[s.length-1];if(!m)throw Error;if(u.eq(m.priceInTicks))m.sizeInBaseLots=m.sizeInBaseLots.add(c);else{if(s.length===i)break;s.push({priceInTicks:u,sizeInBaseLots:c})}}}return{asks:s,bids:n}}levelToUiLevel(e,t){return{price:this.ticksToFloatPrice(e),quantity:this.baseLotsToRawBaseUnits(t)}}getExpectedOutAmount({side:e,inAmount:t,slot:i,unixTimestamp:n}){let s=g(this.data.header.marketSizeParams.bidsSize),o=g(this.data.header.marketSizeParams.asksSize),a=this.getUiLadder(Math.max(s,o),i,n);return Qr({uiLadder:a,side:e,takerFeeBps:this.data.takerFeeBps,inAmount:t})}getRequiredInAmount({side:e,outAmount:t,slot:i,unixTimestamp:n}){let s=g(this.data.header.marketSizeParams.bidsSize),o=g(this.data.header.marketSizeParams.asksSize),a=Vr(this,Math.max(s,o),i,n);return Hi({uiLadder:a,side:e,takerFeeBps:this.data.takerFeeBps,outAmount:t})}getPriceDecimalPlaces(){let e=Math.floor(Math.pow(10,this.data.header.quoteParams.decimals)*this.data.header.rawBaseUnitsPerBaseUnit/g(this.data.header.tickSizeInQuoteAtomsPerBaseUnit));if(e===0)return 0;let t=0;for(;e%2===0;)e/=2,t+=1;let i=0;for(;e%5===0;)e/=5,i+=1;let n=Math.max(t,i);return n===0?3:n}floatPriceToTicks(e){return Math.round(e*this.data.header.rawBaseUnitsPerBaseUnit*T(10,this.data.header.quoteParams.decimals)/(this.data.quoteLotsPerBaseUnitPerTick*g(this.data.header.quoteLotSize)))}ticksToFloatPrice(e){return e*this.data.quoteLotsPerBaseUnitPerTick*g(this.data.header.quoteLotSize)/(T(10,this.data.header.quoteParams.decimals)*this.data.header.rawBaseUnitsPerBaseUnit)}rawBaseUnitsToBaseLotsRoundedDown(e){let t=e/this.data.header.rawBaseUnitsPerBaseUnit;return Math.floor(t*this.data.baseLotsPerBaseUnit)}rawBaseUnitsToBaseLotsRoundedUp(e){let t=e/this.data.header.rawBaseUnitsPerBaseUnit;return Math.ceil(t*this.data.baseLotsPerBaseUnit)}baseAtomsToBaseLots(e){return Math.round(e/g(this.data.header.baseLotSize))}baseLotsToBaseAtoms(e){return e*g(this.data.header.baseLotSize)}baseLotsToRawBaseUnits(e){return this.baseAtomsToRawBaseUnits(this.baseLotsToBaseAtoms(e))}quoteUnitsToQuoteLots(e){return Math.round(e*T(10,this.data.header.quoteParams.decimals)/g(this.data.header.quoteLotSize))}quoteAtomsToQuoteLots(e){return Math.round(e/g(this.data.header.quoteLotSize))}quoteLotsToQuoteAtoms(e){return e*g(this.data.header.quoteLotSize)}quoteLotsToQuoteUnits(e){return this.quoteAtomsToQuoteUnits(this.quoteLotsToQuoteAtoms(e))}baseAtomsToRawBaseUnits(e){return e/T(10,this.data.header.baseParams.decimals)}quoteAtomsToQuoteUnits(e){return e/T(10,this.data.header.quoteParams.decimals)}createCancelAllOrdersInstruction(e){let t=this.address;return At({phoenixProgram:b,logAuthority:p(),market:t,trader:e,baseAccount:this.getBaseAccountKey(e),quoteAccount:this.getQuoteAccountKey(e),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()})}createCancelAllOrdersWithFreeFundsInstruction(e){return Mt({phoenixProgram:b,logAuthority:p(),market:this.address,trader:e})}createCancelMultipleOrdersByIdInstruction(e,t){return Ft({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}createCancelMultipleOrdersByIdWithFreeFundsInstruction(e,t){return Ut({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t},e)}createCancelUpToInstruction(e,t){return Ct({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}createCancelUpToWithFreeFundsInstruction(e,t){return qt({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t},e)}createDepositFundsInstruction(e,t){return Vt({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t),baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}createPlaceLimitOrderInstruction(e,t){return Gt({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t),baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},{orderPacket:e})}createPlaceLimitOrderWithFreeFundsInstruction(e,t){return Jt({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t)},{orderPacket:e})}createPlaceMultiplePostOnlyOrdersInstruction(e,t){return $t({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t),baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}createPlaceMultiplePostOnlyOrdersInstructionWithFreeFunds(e,t){return rr({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t)},e)}createReduceOrderInstruction(e,t){return sr({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}createReduceOrderWithFreeFundsInstruction(e,t){return ur({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t},e)}createRequestSeatInstruction(e,t){return lr({phoenixProgram:b,logAuthority:p(),market:this.address,payer:e,seat:this.getSeatAddress(t)})}createSwapInstruction(e,t){return mr({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},{orderPacket:e})}createSwapWithFreeFundsInstruction(e,t){return yr({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t)},{orderPacket:e})}createWithdrawFundsInstruction(e,t){return Pr({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}getSwapOrderPacket({side:e,inAmount:t,slippage:i=zr,selfTradeBehavior:n=0,matchLimit:s=ji,clientOrderId:o=0,useOnlyDepositedFunds:a=!1,lastValidSlot:u,lastValidUnixTimestampInSeconds:c}){let m=Vr(this,Number.MAX_SAFE_INTEGER),d=Qr({uiLadder:m,takerFeeBps:this.data.takerFeeBps,side:e,inAmount:t}),P=T(10,this.data.header.baseParams.decimals),h=T(10,this.data.header.quoteParams.decimals),K=1-i,A=0,M=0,y=0,B=0;return e===1?(A=t*P/parseFloat(this.data.header.baseLotSize.toString()),B=Math.ceil(d*h/parseFloat(this.data.header.quoteLotSize.toString())*K)):(y=t*h/parseFloat(this.data.header.quoteLotSize.toString()),M=Math.ceil(d*P/parseFloat(this.data.header.baseLotSize.toString())*K)),Ze({side:e,numBaseLots:A,numQuoteLots:y,minBaseLotsToFill:M,minQuoteLotsToFill:B,selfTradeBehavior:n,matchLimit:s,clientOrderId:o,useOnlyDepositedFunds:a,lastValidSlot:u,lastValidUnixTimestampInSeconds:c})}getLimitOrderInstructionfromTemplate(e,t){let i=this.floatPriceToTicks(t.priceAsFloat),n=this.rawBaseUnitsToBaseLotsRoundedDown(t.sizeInBaseUnits),s=Sr({side:t.side,priceInTicks:i,numBaseLots:n,selfTradeBehavior:t.selfTradeBehavior,matchLimit:t.matchLimit,clientOrderId:t.clientOrderId,useOnlyDepositedFunds:t.useOnlyDepositedFunds,lastValidSlot:t.lastValidSlot,lastValidUnixTimestampInSeconds:t.lastValidUnixTimestampInSeconds});return this.createPlaceLimitOrderInstruction(s,e)}getPostOnlyOrderInstructionfromTemplate(e,t){let i=this.floatPriceToTicks(t.priceAsFloat),n=this.rawBaseUnitsToBaseLotsRoundedDown(t.sizeInBaseUnits),s=wr({side:t.side,priceInTicks:i,numBaseLots:n,clientOrderId:t.clientOrderId,rejectPostOnly:t.rejectPostOnly,useOnlyDepositedFunds:t.useOnlyDepositedFunds,lastValidSlot:t.lastValidSlot,lastValidUnixTimestampInSeconds:t.lastValidUnixTimestampInSeconds});return this.createPlaceLimitOrderInstruction(s,e)}getImmediateOrCancelOrderInstructionfromTemplate(e,t){let i=this.floatPriceToTicks(t.priceAsFloat),n=this.rawBaseUnitsToBaseLotsRoundedDown(t.sizeInBaseUnits),s=this.quoteUnitsToQuoteLots(t.sizeInQuoteUnits),o=this.rawBaseUnitsToBaseLotsRoundedDown(t.minBaseUnitsToFill),a=this.quoteUnitsToQuoteLots(t.minQuoteUnitsToFill),u=Ze({side:t.side,priceInTicks:i,numBaseLots:n,numQuoteLots:s,minBaseLotsToFill:o,minQuoteLotsToFill:a,selfTradeBehavior:t.selfTradeBehavior,matchLimit:t.matchLimit,clientOrderId:t.clientOrderId,useOnlyDepositedFunds:t.useOnlyDepositedFunds,lastValidSlot:t.lastValidSlot,lastValidUnixTimestampInSeconds:t.lastValidUnixTimestampInSeconds});return this.createSwapInstruction(u,e)}};var N=class{constructor({address:e,marketSizeParams:t,baseParams:i,baseLotSize:n,quoteParams:s,quoteLotSize:o,tickSizeInQuoteAtomsPerBaseUnit:a,rawBaseUnitsPerBaseUnit:u,baseLotsPerBaseUnit:c,quoteLotsPerBaseUnitPerTick:m,priceDecimalPlaces:d,takerFeeBps:P}){this.address=e,this.marketSizeParams=t,this.baseParams=i,this.baseLotSize=n,this.quoteParams=s,this.quoteLotSize=o,this.rawBaseUnitsPerBaseUnit=u,this.tickSizeInQuoteAtomsPerBaseUnit=a,this.baseLotsPerBaseUnit=c,this.quoteLotsPerBaseUnitPerTick=m,this.priceDecimalPlaces=d,this.takerFeeBps=P}static fromMarketState(e){return new N({address:e.address,marketSizeParams:e.data.header.marketSizeParams,baseParams:e.data.header.baseParams,baseLotSize:g(e.data.header.baseLotSize),quoteParams:e.data.header.quoteParams,quoteLotSize:g(e.data.header.quoteLotSize),tickSizeInQuoteAtomsPerBaseUnit:g(e.data.header.tickSizeInQuoteAtomsPerBaseUnit),rawBaseUnitsPerBaseUnit:e.data.header.rawBaseUnitsPerBaseUnit,baseLotsPerBaseUnit:e.data.baseLotsPerBaseUnit,quoteLotsPerBaseUnitPerTick:e.data.quoteLotsPerBaseUnitPerTick,priceDecimalPlaces:e.getPriceDecimalPlaces(),takerFeeBps:e.data.takerFeeBps})}getSeatAddress(e){return ie(this.address,e)}getBaseAccountKey(e){return _spltoken.getAssociatedTokenAddressSync.call(void 0, this.baseParams.mintKey,e,!0)}getQuoteAccountKey(e){return _spltoken.getAssociatedTokenAddressSync.call(void 0, this.quoteParams.mintKey,e,!0)}getQuoteVaultKey(){return this.quoteParams.vaultKey}getBaseVaultKey(){return this.baseParams.vaultKey}floatPriceToTicks(e){return Math.round(e*this.rawBaseUnitsPerBaseUnit*T(10,this.quoteParams.decimals)/(this.quoteLotsPerBaseUnitPerTick*this.quoteLotSize))}ticksToFloatPrice(e){return e*this.quoteLotsPerBaseUnitPerTick*this.quoteLotSize/(T(10,this.quoteParams.decimals)*this.rawBaseUnitsPerBaseUnit)}rawBaseUnitsToBaseLotsRoundedDown(e){let t=e/this.rawBaseUnitsPerBaseUnit;return Math.floor(t*this.baseLotsPerBaseUnit)}rawBaseUnitsToBaseLotsRoundedUp(e){let t=e/this.rawBaseUnitsPerBaseUnit;return Math.ceil(t*this.baseLotsPerBaseUnit)}baseAtomsToBaseLots(e){return Math.round(e/this.baseLotSize)}baseLotsToBaseAtoms(e){return e*this.baseLotSize}baseLotsToRawBaseUnits(e){return this.baseAtomsToRawBaseUnits(this.baseLotsToBaseAtoms(e))}quoteUnitsToQuoteLots(e){return Math.round(e*T(10,this.quoteParams.decimals)/this.quoteLotSize)}quoteAtomsToQuoteLots(e){return Math.round(e/this.quoteLotSize)}quoteLotsToQuoteAtoms(e){return e*this.quoteLotSize}quoteLotsToQuoteUnits(e){return this.quoteAtomsToQuoteUnits(this.quoteLotsToQuoteAtoms(e))}baseAtomsToRawBaseUnits(e){return e/T(10,this.baseParams.decimals)}quoteAtomsToQuoteUnits(e){return e/T(10,this.quoteParams.decimals)}createCancelAllOrdersInstruction(e){let t=this.address;return At({phoenixProgram:b,logAuthority:p(),market:t,trader:e,baseAccount:this.getBaseAccountKey(e),quoteAccount:this.getQuoteAccountKey(e),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()})}createCancelAllOrdersWithFreeFundsInstruction(e){return Mt({phoenixProgram:b,logAuthority:p(),market:this.address,trader:e})}createCancelMultipleOrdersByIdInstruction(e,t){return Ft({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}createCancelMultipleOrdersByIdWithFreeFundsInstruction(e,t){return Ut({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t},e)}createCancelUpToInstruction(e,t){return Ct({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}createCancelUpToWithFreeFundsInstruction(e,t){return qt({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t},e)}createDepositFundsInstruction(e,t){return Vt({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t),baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}createPlaceLimitOrderInstruction(e,t){return Gt({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t),baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},{orderPacket:e})}createPlaceLimitOrderWithFreeFundsInstruction(e,t){return Jt({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t)},{orderPacket:e})}createPlaceMultiplePostOnlyOrdersInstruction(e,t){return $t({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t),baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}createPlaceMultiplePostOnlyOrdersInstructionWithFreeFunds(e,t){return rr({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t)},e)}createReduceOrderInstruction(e,t){return sr({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}createReduceOrderWithFreeFundsInstruction(e,t){return ur({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t},e)}createRequestSeatInstruction(e,t){return lr({phoenixProgram:b,logAuthority:p(),market:this.address,payer:e,seat:this.getSeatAddress(t)})}createSwapInstruction(e,t){return mr({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},{orderPacket:e})}createSwapWithFreeFundsInstruction(e,t){return yr({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,seat:this.getSeatAddress(t)},{orderPacket:e})}createWithdrawFundsInstruction(e,t){return Pr({phoenixProgram:b,logAuthority:p(),market:this.address,trader:t,baseAccount:this.getBaseAccountKey(t),quoteAccount:this.getQuoteAccountKey(t),baseVault:this.getBaseVaultKey(),quoteVault:this.getQuoteVaultKey()},e)}getLimitOrderInstructionfromTemplate(e,t){let i=this.floatPriceToTicks(t.priceAsFloat),n=this.rawBaseUnitsToBaseLotsRoundedDown(t.sizeInBaseUnits),s=Sr({side:t.side,priceInTicks:i,numBaseLots:n,selfTradeBehavior:t.selfTradeBehavior,matchLimit:t.matchLimit,clientOrderId:t.clientOrderId,useOnlyDepositedFunds:t.useOnlyDepositedFunds,lastValidSlot:t.lastValidSlot,lastValidUnixTimestampInSeconds:t.lastValidUnixTimestampInSeconds});return this.createPlaceLimitOrderInstruction(s,e)}getPostOnlyOrderInstructionfromTemplate(e,t){let i=this.floatPriceToTicks(t.priceAsFloat),n=this.rawBaseUnitsToBaseLotsRoundedDown(t.sizeInBaseUnits),s=wr({side:t.side,priceInTicks:i,numBaseLots:n,clientOrderId:t.clientOrderId,rejectPostOnly:t.rejectPostOnly,useOnlyDepositedFunds:t.useOnlyDepositedFunds,lastValidSlot:t.lastValidSlot,lastValidUnixTimestampInSeconds:t.lastValidUnixTimestampInSeconds});return this.createPlaceLimitOrderInstruction(s,e)}getImmediateOrCancelOrderInstructionfromTemplate(e,t){let i=this.floatPriceToTicks(t.priceAsFloat),n=this.rawBaseUnitsToBaseLotsRoundedDown(t.sizeInBaseUnits),s=this.quoteUnitsToQuoteLots(t.sizeInQuoteUnits),o=this.rawBaseUnitsToBaseLotsRoundedDown(t.minBaseUnitsToFill),a=this.quoteUnitsToQuoteLots(t.minQuoteUnitsToFill),u=Ze({side:t.side,priceInTicks:i,numBaseLots:n,numQuoteLots:s,minBaseLotsToFill:o,minQuoteLotsToFill:a,selfTradeBehavior:t.selfTradeBehavior,matchLimit:t.matchLimit,clientOrderId:t.clientOrderId,useOnlyDepositedFunds:t.useOnlyDepositedFunds,lastValidSlot:t.lastValidSlot,lastValidUnixTimestampInSeconds:t.lastValidUnixTimestampInSeconds});return this.createSwapInstruction(u,e)}};var yn="https://raw.githubusercontent.com/Ellipsis-Labs/phoenix-sdk/master/master_config.json",ae= exports.Client =class{constructor({connection:e,cluster:t,tokenConfigs:i,marketStates:n,marketMetadatas:s,marketConfigs:o,clock:a}){this.connection=e,this.cluster=t,this.tokenConfigs=i,this.marketStates=n,this.marketMetadatas=s,this.marketConfigs=o,this.clock=a}static createFromConfig(e,t,i=!1,n=!0){return f(this,null,function*(){let s=yield wt(e),o=new Map;t[s].tokens.forEach(A=>{o.set(A.mint,A)});let a=new Map,u=[];t[s].markets.forEach(A=>{let M=o.get(A.baseMint),y=o.get(A.quoteMint),B=A.market;if(M!==void 0&&y!==void 0)a.set(A.market,{marketId:B,name:`${M.symbol}/${y.symbol}`,baseToken:M,quoteToken:y}),u.push(new (0, _web3js.PublicKey)(B));else throw new Error("Received invalid market config")});let c=new Map,m=new Map,d=[];i||d.push(...u),d.push(_web3js.SYSVAR_CLOCK_PUBKEY);let P=n?yield oe(e,u):yield se(e,u),h=P.pop();if(h===void 0)throw new Error("Unable to get clock");let K=Ge(h);return i||u.map((M,y)=>[M,P[y]]).forEach(([M,y])=>{let B=D.load({address:M,buffer:y});c.set(M.toString(),B);let U=N.fromMarketState(B);m.set(M.toString(),U)}),new ae({connection:e,cluster:s,tokenConfigs:o,clock:K,marketStates:c,marketMetadatas:m,marketConfigs:a})})}static create(n){return f(this,arguments,function*(e,t=!1,i=yn){let s=yield fetch(i).then(o=>o.json());return yield ae.createFromConfig(e,s,t)})}static createWithoutConfig(e,t,i=!0){return f(this,null,function*(){let n=yield wt(e),s=i?yield oe(e,t):yield se(e,t),o=s.pop();if(o===void 0)throw new Error("Unable to get clock");let a=Ge(o);if(s.length!==t.length)throw Error("Unable to get all market accounts");let u=new Map,c=new Map;return t.map((d,P)=>[d,s[P]]).forEach(([d,P])=>{let h=D.load({address:d,buffer:P});u.set(d.toString(),h);let K=N.fromMarketState(h);c.set(d.toString(),K)}),new ae({connection:e,cluster:n,marketConfigs:new Map,marketStates:u,marketMetadatas:c,tokenConfigs:new Map,clock:a})})}static createWithMarketAddresses(s,o){return f(this,arguments,function*(e,t,i=yn,n=!0){let a=yield wt(e),u=yield fetch(i).then(y=>y.json()),c=new Map;u[a].tokens.forEach(y=>{c.set(y.mint,y)});let m=new Map;u[a].markets.forEach(y=>{let B=c.get(y.baseMint),U=c.get(y.quoteMint),Ce=y.market;if(B!==void 0&&U!==void 0)m.set(y.market,{marketId:Ce,name:`${B.symbol}/${U.symbol}`,baseToken:B,quoteToken:U});else throw new Error("Received invalid market config")});let d=n?yield oe(e,t):yield se(e,t),P=d.pop();if(P===void 0)throw new Error("Unable to get clock");let h=Ge(P),K=new Map,A=new Map;return t.map((y,B)=>[y,d[B]]).forEach(([y,B])=>{let U=D.load({address:y,buffer:B});K.set(y.toString(),U);let Ce=N.fromMarketState(U);A.set(y.toString(),Ce)}),new ae({connection:e,cluster:a,tokenConfigs:c,marketStates:K,marketConfigs:m,marketMetadatas:A,clock:h})})}addMarket(e,t=!1,i=!0){return f(this,null,function*(){let n=this.marketStates.get(e);if(n!==void 0){if(t?yield this.refreshMarket(e):console.log("Market already exists: ",e),!this.marketMetadatas.has(e)||t){let c=N.fromMarketState(n);this.marketMetadatas.set(e,c)}return}let s=new (0, _web3js.PublicKey)(e),[o,a]=i?yield oe(this.connection,[s]):yield se(this.connection,[s]),u=D.load({address:s,buffer:o});if(this.marketStates.set(e,u),!this.marketMetadatas.has(e)||t){let c=N.fromMarketState(u);this.marketMetadatas.set(e,c)}this.reloadClockFromBuffer(a)})}refreshAllMarkets(e=!0){return f(this,null,function*(){let t=Array.from(this.marketStates.keys()).map(s=>new (0, _web3js.PublicKey)(s)),i=e?yield oe(this.connection,t):yield se(this.connection,t),n=i.pop();if(n===void 0)throw new Error("Unable to get clock");this.reloadClockFromBuffer(n);for(let[s,o]of t.entries()){let a=this.marketStates.get(o.toString());if(a===void 0)throw new Error("Market does not exist: "+o.toBase58());let u=i[s];if(u===void 0)throw new Error("Unable to get market account data");a.reload(u)}})}refreshMarket(e,t=!0){return f(this,null,function*(){let i=new (0, _web3js.PublicKey)(e),n=this.marketStates.get(i.toString());if(n===void 0)throw new Error("Market does not exist: "+i.toBase58());let[s,o]=t?yield oe(this.connection,[i]):yield se(this.connection,[i]);if(n.reload(s),o===void 0)throw new Error("Unable to get clock");return this.reloadClockFromBuffer(o),n})}reloadClock(){return f(this,null,function*(){let e=yield this.connection.getAccountInfo(_web3js.SYSVAR_CLOCK_PUBKEY,"confirmed"),t=e==null?void 0:e.data;if(t===void 0)throw new Error("Unable to get clock");this.reloadClockFromBuffer(t)})}reloadClockFromBuffer(e){this.clock=Ge(e)}getLadder(e,t=re){let i=this.marketStates.get(e);if(!i)throw new Error("Market not found: "+e);return i.getLadder(this.clock.slot,this.clock.unixTimestamp,t)}getUiLadder(e,t=re){let i=this.marketStates.get(e);if(!i)throw new Error("Market not found: "+e);return i.getUiLadder(t,this.clock.slot,this.clock.unixTimestamp)}getL3Book(e,t=ne){let i=this.marketStates.get(e);if(!i)throw new Error("Market not found: "+e);return ht(i.data,this.clock.slot,this.clock.unixTimestamp,t)}getL3BookWithParams(e,t,i,n=ne){let s=this.marketStates.get(e);if(!s)throw new Error("Market not found: "+e);return ht(s.data,t,i,n)}getL3UiBook(e,t=ne){let i=this.marketStates.get(e);if(!i)throw new Error("Market not found: "+e);return Nr(i.data,t,this.clock.slot,this.clock.unixTimestamp)}getL3UiBookWithParams(e,t,i,n=ne){let s=this.marketStates.get(e);if(!s)throw new Error("Market not found: "+e);return Nr(s.data,n,t,i)}printLadder(e){Zi(this.getUiLadder(e))}getMarketExpectedOutAmount({marketAddress:e,side:t,inAmount:i}){let n=this.marketStates.get(e);if(!n)throw new Error("Market not found: "+e);return n.getExpectedOutAmount({side:t,inAmount:i,slot:this.clock.slot,unixTimestamp:this.clock.unixTimestamp})}getBaseAccountKey(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.getBaseAccountKey(e)}getQuoteAccountKey(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.getQuoteAccountKey(e)}getQuoteVaultKey(e){let t=this.marketMetadatas.get(e);if(!t)throw new Error("Market not found: "+e);return t.getQuoteVaultKey()}getBaseVaultKey(e){let t=this.marketMetadatas.get(e);if(!t)throw new Error("Market not found: "+e);return t.getBaseVaultKey()}getSeatKey(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.getSeatAddress(e)}floatPriceToTicks(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.floatPriceToTicks(e)}ticksToFloatPrice(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.ticksToFloatPrice(e)}rawBaseUnitsToBaseLotsRoundedDown(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.rawBaseUnitsToBaseLotsRoundedDown(e)}rawBaseUnitsToBaseLotsRoundedUp(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.rawBaseUnitsToBaseLotsRoundedUp(e)}baseAtomsToBaseLots(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.baseAtomsToBaseLots(e)}baseLotsToBaseAtoms(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.baseLotsToBaseAtoms(e)}quoteUnitsToQuoteLots(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.quoteUnitsToQuoteLots(e)}quoteAtomsToQuoteLots(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.quoteAtomsToQuoteLots(e)}quoteLotsToQuoteAtoms(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.quoteLotsToQuoteAtoms(e)}baseAtomsToRawBaseUnits(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.baseAtomsToRawBaseUnits(e)}quoteAtomsToQuoteUnits(e,t){let i=this.marketMetadatas.get(t);if(!i)throw new Error("Market not found: "+t);return i.quoteAtomsToQuoteUnits(e)}createCancelAllOrdersInstruction(e,t){let i=this.marketMetadatas.get(e);if(!i)throw new Error("Market not found: "+e);return i.createCancelAllOrdersInstruction(t)}createCancelAllOrdersWithFreeFundsInstruction(e,t){let i=this.marketMetadatas.get(e);if(!i)throw new Error("Market not found: "+e);return i.createCancelAllOrdersWithFreeFundsInstruction(t)}createCancelMultipleOrdersByIdInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createCancelMultipleOrdersByIdInstruction(e,i)}createCancelMultipleOrdersByIdWithFreeFundsInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createCancelMultipleOrdersByIdWithFreeFundsInstruction(e,i)}createCancelUpToInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createCancelUpToInstruction(e,i)}createCancelUpToWithFreeFundsInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createCancelUpToWithFreeFundsInstruction(e,i)}createDepositFundsInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createDepositFundsInstruction(e,i)}createPlaceLimitOrderInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createPlaceLimitOrderInstruction(e,i)}createPlaceLimitOrderWithFreeFundsInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createPlaceLimitOrderWithFreeFundsInstruction(e,i)}createPlaceMultiplePostOnlyOrdersInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createPlaceMultiplePostOnlyOrdersInstruction(e,i)}createPlaceMultiplePostOnlyOrdersInstructionWithFreeFunds(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createPlaceMultiplePostOnlyOrdersInstructionWithFreeFunds(e,i)}createReduceOrderInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createReduceOrderInstruction(e,i)}createReduceOrderWithFreeFundsInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createReduceOrderWithFreeFundsInstruction(e,i)}createRequestSeatInstruction(e,t,i){i||(i=t);let n=this.marketMetadatas.get(e);if(!n)throw new Error("Market not found: "+e);return n.createRequestSeatInstruction(t,i)}createSwapInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createSwapInstruction(e,i)}createSwapWithFreeFundsInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createSwapWithFreeFundsInstruction(e,i)}createWithdrawFundsInstruction(e,t,i){let n=this.marketMetadatas.get(t);if(!n)throw new Error("Market not found: "+t);return n.createWithdrawFundsInstruction(e,i)}getLimitOrderInstructionfromTemplate(e,t,i){let n=this.marketMetadatas.get(e);if(!n)throw new Error("Market not found: "+e);return n.getLimitOrderInstructionfromTemplate(t,i)}getPostOnlyOrderInstructionfromTemplate(e,t,i){let n=this.marketMetadatas.get(e);if(!n)throw new Error("Market not found: "+e);return n.getPostOnlyOrderInstructionfromTemplate(t,i)}getImmediateOrCancelOrderIxfromTemplate(e,t,i){let n=this.marketMetadatas.get(e);if(!n)throw new Error("Market not found: "+e);return n.getImmediateOrCancelOrderInstructionfromTemplate(t,i)}};function wr({side:r,priceInTicks:e,numBaseLots:t,rejectPostOnly:i=!0,clientOrderId:n=0,useOnlyDepositedFunds:s=!1,lastValidSlot:o,lastValidUnixTimestampInSeconds:a,failSilientlyOnInsufficientFunds:u}){return{__kind:"PostOnly",side:r,priceInTicks:e,numBaseLots:t,clientOrderId:n!=null?n:0,rejectPostOnly:i!=null?i:!0,useOnlyDepositedFunds:s!=null?s:!1,lastValidSlot:o!=null?o:null,lastValidUnixTimestampInSeconds:a!=null?a:null,failSilentlyOnInsufficientFunds:u!=null?u:!1}}function Sr({side:r,priceInTicks:e,numBaseLots:t,selfTradeBehavior:i=1,matchLimit:n,clientOrderId:s=0,useOnlyDepositedFunds:o=!1,lastValidSlot:a,lastValidUnixTimestampInSeconds:u,failSilientlyOnInsufficientFunds:c}){return{__kind:"Limit",side:r,priceInTicks:e,numBaseLots:t,selfTradeBehavior:i!=null?i:1,matchLimit:n!=null?n:null,clientOrderId:s!=null?s:0,useOnlyDepositedFunds:o!=null?o:!1,lastValidSlot:a!=null?a:null,lastValidUnixTimestampInSeconds:u!=null?u:null,failSilentlyOnInsufficientFunds:c!=null?c:!1}}function Ze({side:r,priceInTicks:e,numBaseLots:t,numQuoteLots:i,minBaseLotsToFill:n=0,minQuoteLotsToFill:s=0,selfTradeBehavior:o=1,matchLimit:a,clientOrderId:u=0,useOnlyDepositedFunds:c=!1,lastValidSlot:m,lastValidUnixTimestampInSeconds:d}){return{__kind:"ImmediateOrCancel",side:r,priceInTicks:e!=null?e:null,numBaseLots:t,numQuoteLots:i,minBaseLotsToFill:n,minQuoteLotsToFill:s,selfTradeBehavior:o,matchLimit:a!=null?a:null,clientOrderId:u,useOnlyDepositedFunds:c,lastValidSlot:m!=null?m:null,lastValidUnixTimestampInSeconds:d!=null?d:null}}var Ls="PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY",b= exports.PROGRAM_ID =new (0, _web3js.PublicKey)(Ls);function p(){return _web3js.PublicKey.findProgramAddressSync([Buffer.from("log")],b)[0]}exports.CancelAllOrdersStruct = _n; exports.CancelAllOrdersWithFreeFundsStruct = Gn; exports.CancelMultipleOrdersByIdStruct = Hn; exports.CancelMultipleOrdersByIdWithFreeFundsStruct = Yn; exports.CancelMultipleOrdersErrorError = Ie; exports.CancelUpToStruct = $n; exports.CancelUpToWithFreeFundsStruct = ts; exports.Client = ae; exports.DEFAULT_L2_LADDER_DEPTH = re; exports.DEFAULT_L3_BOOK_DEPTH = ne; exports.DEFAULT_MATCH_LIMIT = ji; exports.DEFAULT_SLIPPAGE_PERCENT = zr; exports.DepositFundsStruct = is; exports.EvictionErrorError = Fe; exports.FailedMultipleLimitOrderBehavior = mi; exports.FailedToLoadMarketFromAccountError = le; exports.InvalidBaseAccountError = he; exports.InvalidBaseVaultError = ke; exports.InvalidLotSizeError = ge; exports.InvalidMarketAuthorityError = ce; exports.InvalidMarketParametersError = ue; exports.InvalidMarketSignerError = pe; exports.InvalidMintError = fe; exports.InvalidQuoteAccountError = we; exports.InvalidQuoteVaultError = Pe; exports.InvalidSeatStatusError = Ke; exports.InvalidStateTransitionError = me; exports.InvalidTickSizeError = ye; exports.LogStruct = ss; exports.MarketAlreadyInitializedError = be; exports.MarketMetadata = N; exports.MarketState = D; exports.MarketStatus = li; exports.MarketUninitializedError = de; exports.NewOrderErrorError = xe; exports.PROGRAM_ADDRESS = Ls; exports.PROGRAM_ID = b; exports.PlaceLimitOrderStruct = os; exports.PlaceLimitOrderWithFreeFundsStruct = us; exports.PlaceMultiplePostOnlyOrdersStruct = ls; exports.PlaceMultiplePostOnlyOrdersWithFreeFundsStruct = ds; exports.ReduceOrderErrorError = Ae; exports.ReduceOrderStruct = ps; exports.ReduceOrderWithFreeFundsStruct = ys; exports.RemoveEmptyOrdersErrorError = Me; exports.RequestSeatStruct = ks; exports.SeatApprovalStatus = wi; exports.SelfTradeBehavior = it; exports.Side = He; exports.SwapStruct = hs; exports.SwapWithFreeFundsStruct = Ss; exports.TooManyEventsError = Se; exports.TraderNotFoundError = Te; exports.WithdrawFundsErrorError = Be; exports.WithdrawFundsStruct = As; exports.auditLogHeaderBeet = Yr; exports.cancelAllOrdersInstructionDiscriminator = jn; exports.cancelAllOrdersWithFreeFundsInstructionDiscriminator = Zn; exports.cancelMultipleOrdersByIdInstructionDiscriminator = Jn; exports.cancelMultipleOrdersByIdParamsBeet = Xe; exports.cancelMultipleOrdersByIdWithFreeFundsInstructionDiscriminator = Xn; exports.cancelOrderParamsBeet = Je; exports.cancelUpToInstructionDiscriminator = es; exports.cancelUpToParamsBeet = $e; exports.cancelUpToWithFreeFundsInstructionDiscriminator = rs; exports.clockBeet = Qn; exports.condensedOrderBeet = Ir; exports.confirmOrCreateClaimSeatIxs = qr; exports.createCancelAllOrdersInstruction = At; exports.createCancelAllOrdersWithFreeFundsInstruction = Mt; exports.createCancelMultipleOrdersByIdInstruction = Ft; exports.createCancelMultipleOrdersByIdWithFreeFundsInstruction = Ut; exports.createCancelUpToInstruction = Ct; exports.createCancelUpToWithFreeFundsInstruction = qt; exports.createClaimSeatInstructions = ju; exports.createDepositFundsInstruction = Vt; exports.createLogInstruction = ul; exports.createPlaceLimitOrderInstruction = Gt; exports.createPlaceLimitOrderWithFreeFundsInstruction = Jt; exports.createPlaceMultiplePostOnlyOrdersInstruction = $t; exports.createPlaceMultiplePostOnlyOrdersWithFreeFundsInstruction = rr; exports.createReduceOrderInstruction = sr; exports.createReduceOrderWithFreeFundsInstruction = ur; exports.createRequestSeatInstruction = lr; exports.createSwapInstruction = mr; exports.createSwapWithFreeFundsInstruction = yr; exports.createWithdrawFundsInstruction = Pr; exports.decodePhoenixEvents = Fs; exports.depositFundsInstructionDiscriminator = ns; exports.depositParamsBeet = $r; exports.deserializeClockData = Ge; exports.deserializeMarketData = je; exports.deserializeSeatManagerData = Ln; exports.errorFromCode = Ws; exports.errorFromName = Es; exports.evictEventBeet = ti; exports.expiredOrderEventBeet = ii; exports.failedMultipleLimitOrderBehaviorBeet = pi; exports.feeEventBeet = ni; exports.fillEventBeet = oi; exports.fillSummaryEventBeet = ai; exports.findTraderToEvict = vi; exports.getBaseAmountFromQuoteAmountBudgetAndBook = Ji; exports.getCancelOrderParamsFromL3Order = gc; exports.getClaimSeatIx = Ri; exports.getClusterFromConnection = wt; exports.getConfirmedMarketAccountZstd = Fc; exports.getConfirmedMarketsAndClockAccounts = se; exports.getConfirmedMarketsAndClockAccountsZstd = oe; exports.getCreateTokenAccountInstructions = Ur; exports.getEventsFromTransaction = Ib; exports.getEvictSeatIx = qi; exports.getExpectedOutAmountRouter = Qr; exports.getImmediateOrCancelOrderPacket = Ze; exports.getLimitOrderNewMakerIxs = Pc; exports.getLimitOrderPacket = Sr; exports.getLimitOrderUnknownSeatIxs = hc; exports.getLogAuthority = p; exports.getMakerSetupInstructionsForMarket = Nn; exports.getMarketL3Book = ht; exports.getMarketL3UiBook = Nr; exports.getMarketLadder = yc; exports.getMarketSwapTransaction = kc; exports.getMarketUiLadder = Vr; exports.getOrderSequenceNumberFromL3Order = Rn; exports.getPhoenixEventsFromLogData = Os; exports.getPhoenixEventsFromTransactionData = dn; exports.getPhoenixEventsFromTransactionSignature = Ab; exports.getPostOnlyOrderPacket = wr; exports.getQuoteAmountFromBaseAmountBudgetAndBook = Yi; exports.getQuoteUnitsInFromRawBaseUnitsOut = Vn; exports.getQuoteUnitsOutFromRawBaseUnitsIn = vn; exports.getRawBaseUnitsInFromQuoteUnitsOut = zn; exports.getRawBaseUnitsOutFromQuoteUnitsIn = qn; exports.getRequiredInAmountRouter = Hi; exports.getSeatAddress = ie; exports.getSeatDepositCollectorAddress = Di; exports.getSeatManagerAddress = Rr; exports.getUiOrderSequenceNumber = _e; exports.initializeParamsBeet = no; exports.isOrderPacketImmediateOrCancel = Mo; exports.isOrderPacketLimit = Bo; exports.isOrderPacketPostOnly = Io; exports.isPhoenixMarketEventEvict = ta; exports.isPhoenixMarketEventExpiredOrder = sa; exports.isPhoenixMarketEventFee = ia; exports.isPhoenixMarketEventFill = Xo; exports.isPhoenixMarketEventFillSummary = ra; exports.isPhoenixMarketEventHeader = Yo; exports.isPhoenixMarketEventPlace = $o; exports.isPhoenixMarketEventReduce = ea; exports.isPhoenixMarketEventTimeInForce = na; exports.isPhoenixMarketEventUninitialized = Jo; exports.levelToUiLevel = fc; exports.logInstructionDiscriminator = _r; exports.marketHeaderBeet = Tr; exports.marketSizeParamsBeet = et; exports.marketStatusBeet = bi; exports.multipleOrderPacketBeet = rt; exports.orderPacketBeet = Y; exports.phoenixEventsBeet = Ks; exports.phoenixMarketEventBeet = Pi; exports.placeEventBeet = yi; exports.placeLimitOrderInstructionDiscriminator = as; exports.placeLimitOrderWithFreeFundsInstructionDiscriminator = cs; exports.placeMultiplePostOnlyOrdersInstructionDiscriminator = bs; exports.placeMultiplePostOnlyOrdersWithFreeFundsInstructionDiscriminator = ms; exports.printUiLadder = Zi; exports.readPublicKey = bn; exports.reduceEventBeet = fi; exports.reduceOrderInstructionDiscriminator = gs; exports.reduceOrderParamsBeet = st; exports.reduceOrderWithFreeFundsInstructionDiscriminator = fs; exports.requestSeatInstructionDiscriminator = Ps; exports.seatApprovalStatusBeet = da; exports.seatBeet = la; exports.seatManagerBeet = Un; exports.selfTradeBehaviorBeet = Kr; exports.sideBeet = Z; exports.sign = ze; exports.swapInstructionDiscriminator = ws; exports.swapWithFreeFundsInstructionDiscriminator = xs; exports.timeInForceEventBeet = ki; exports.toBN = O; exports.toNum = g; exports.tokenParamsBeet = Mr; exports.withdrawFundsInstructionDiscriminator = Is; exports.withdrawParamsBeet = Si;
